# Istioä¸€è‡´æ€§éªŒè¯å’Œå¯è§†åŒ–ç³»ç»Ÿ

> å…¨å±€åŒ–ã€ç³»ç»ŸåŒ–çš„Istioé…ç½®ä¸€è‡´æ€§éªŒè¯ä¸å¯è§†åŒ–å¹³å°

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

æœ¬ç³»ç»Ÿæ˜¯ä¸€ä¸ªç»Ÿä¸€çš„Istioé…ç½®ä¸€è‡´æ€§éªŒè¯å¹³å°ï¼Œæ•´åˆäº†**é™æ€åˆ†æ**ã€**åŠ¨æ€æµ‹è¯•**å’Œ**ä¸€è‡´æ€§æ£€æµ‹**ä¸‰å¤§æ ¸å¿ƒæ¨¡å—ï¼Œæä¾›ç«¯åˆ°ç«¯çš„é…ç½®éªŒè¯èƒ½åŠ›å’Œå¯è§†åŒ–æŠ¥å‘Šã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **é™æ€é…ç½®åˆ†æ**: è§£ææ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢é…ç½®ï¼Œæå–ç­–ç•¥å’ŒæœåŠ¡å…³ç³»
- âœ… **åŠ¨æ€æµ‹è¯•åˆ†æ**: æ•´åˆæ­£äº¤æµ‹è¯•ç”¨ä¾‹å’Œè¿è¡Œæ—¶éªŒè¯ç»“æœ
- âœ… **ä¸€è‡´æ€§æ£€æµ‹**: å¯¹æ¯”é™æ€ç­–ç•¥ä¸åŠ¨æ€è¡Œä¸ºï¼Œè¯†åˆ«ä¸ä¸€è‡´æ€§å’Œåå·®
- âœ… **å›¾è°±å¯è§†åŒ–**: ç”ŸæˆæœåŠ¡æ‹“æ‰‘å›¾ï¼Œé«˜äº®æ˜¾ç¤ºä¸ä¸€è‡´åŒºåŸŸ
- âœ… **ç»¼åˆæŠ¥å‘Š**: ç”ŸæˆHTML/JSONæ ¼å¼çš„è¯¦ç»†éªŒè¯æŠ¥å‘Š
- âœ… **Webç•Œé¢**: æä¾›äº¤äº’å¼Webç•Œé¢æŸ¥çœ‹å’Œç®¡ç†éªŒè¯ç»“æœ
- âœ… **å…¨å±€é…ç½®**: ç»Ÿä¸€çš„é…ç½®ç®¡ç†å’Œæµç¨‹ç¼–æ’

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
consistency_checker/
â”œâ”€â”€ config.py                 # å…¨å±€é…ç½®ç®¡ç†
â”œâ”€â”€ main.py                   # ä¸»å…¥å£ç¨‹åº
â”œâ”€â”€ models/                   # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ data_models.py        # ç»Ÿä¸€æ•°æ®ç»“æ„
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ core/                     # æ ¸å¿ƒåˆ†æå¼•æ“
â”‚   â”œâ”€â”€ static_analyzer.py    # é™æ€åˆ†æå™¨
â”‚   â”œâ”€â”€ dynamic_analyzer.py   # åŠ¨æ€åˆ†æå™¨
â”‚   â”œâ”€â”€ consistency_checker.py # ä¸€è‡´æ€§æ£€æµ‹å™¨
â”‚   â”œâ”€â”€ orchestrator.py       # æµç¨‹ç¼–æ’å™¨
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ visualizer/               # å¯è§†åŒ–ç»„ä»¶
â”‚   â”œâ”€â”€ graph_generator.py    # å›¾è°±ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ report_generator.py   # æŠ¥å‘Šç”Ÿæˆå™¨
â”‚   â””â”€â”€ __init__.py
â””â”€â”€ web/                      # Webå¯è§†åŒ–
    â”œâ”€â”€ server.py             # FlaskæœåŠ¡å™¨
    â””â”€â”€ __init__.py
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. é…ç½®ç³»ç»Ÿ

åˆ›å»ºé…ç½®æ–‡ä»¶ `config.json`ï¼ˆå¯é€‰ï¼‰:

```json
{
  "namespace": "online-boutique",
  "control_plane_config_dir": "istio_config_parser/istio_control_config",
  "test_matrix_file": "istio_Dynamic_Test/generator/output_matrix.json",
  "consistency_output_dir": "results/consistency",
  "traffic_split_tolerance": 0.1
}
```

### 3. è¿è¡ŒéªŒè¯

#### æ–¹å¼1ï¼šè¿è¡Œå®Œæ•´æµæ°´çº¿

```bash
python -m consistency_checker.main --mode full --namespace online-boutique
```

#### æ–¹å¼2ï¼šä»…è¿è¡Œé™æ€åˆ†æ

```bash
python -m consistency_checker.main --mode static --namespace online-boutique
```

#### æ–¹å¼3ï¼šä»…è¿è¡Œä¸€è‡´æ€§æ£€æŸ¥

```bash
python -m consistency_checker.main --mode consistency --namespace online-boutique
```

#### æ–¹å¼4ï¼šå¯åŠ¨Webå¯è§†åŒ–ç•Œé¢

```bash
python -m consistency_checker.main --mode web --port 8080
```

ç„¶åè®¿é—® `http://localhost:8080`

### 4. æŸ¥çœ‹ç»“æœ

éªŒè¯ç»“æœä¼šä¿å­˜åœ¨ä»¥ä¸‹ç›®å½•ï¼š

- **JSONæŠ¥å‘Š**: `results/consistency/report_*.json`
- **HTMLæŠ¥å‘Š**: `results/visualization/report_*_report.html`
- **å›¾æ•°æ®**: `results/visualization/report_*_graph.json`

## ğŸ“Š æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç›‘æ§å™¨è·å–     â”‚
â”‚ æ§åˆ¶å¹³é¢/æ•°æ®å¹³é¢ â”‚
â”‚     é…ç½®        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¨¡å—1: é™æ€é…ç½®åˆ†æ             â”‚
â”‚  - è§£æVirtualService           â”‚
â”‚  - è§£æDestinationRule         â”‚
â”‚  - æå–ç­–ç•¥å’ŒæœåŠ¡å…³ç³»             â”‚
â”‚  - æ„å»ºæœåŠ¡æ‹“æ‰‘å›¾                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ è¾“å‡ºï¼šStaticPolicy[], ServiceNode[], ConfigEdge[]
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¨¡å—2: åŠ¨æ€æµ‹è¯•ä¸éªŒè¯           â”‚
â”‚  - åŠ è½½æ­£äº¤æµ‹è¯•çŸ©é˜µ              â”‚
â”‚  - åŠ è½½éªŒè¯ç»“æœ                  â”‚
â”‚  - æå–åŠ¨æ€è¡Œä¸º                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ è¾“å‡ºï¼šDynamicBehavior[], TestResults
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ¨¡å—3: ä¸€è‡´æ€§æ£€æµ‹ä¸å¯è§†åŒ–       â”‚
â”‚  - ç­–ç•¥æœ‰æ•ˆæ€§æ£€æŸ¥                â”‚
â”‚  - ä½œç”¨èŒƒå›´ä¸€è‡´æ€§                â”‚
â”‚  - è¡Œä¸ºåå·®æ£€æµ‹                  â”‚
â”‚  - ç­–ç•¥å†²çªåˆ†æ                  â”‚
â”‚  - ç”Ÿæˆå›¾è°±å’ŒæŠ¥å‘Š                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        è¾“å‡ºç»“æœ                  â”‚
â”‚  - ConsistencyResult            â”‚
â”‚  - VerificationReport           â”‚
â”‚  - HTMLå¯è§†åŒ–æŠ¥å‘Š                â”‚
â”‚  - äº¤äº’å¼æœåŠ¡æ‹“æ‰‘å›¾               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ å‘½ä»¤è¡Œé€‰é¡¹

```
python -m consistency_checker.main [é€‰é¡¹]

é€‰é¡¹:
  --mode {full,static,consistency,web}
                        è¿è¡Œæ¨¡å¼
  --namespace NAMESPACE
                        Kuberneteså‘½åç©ºé—´ (é»˜è®¤: default)
  --config CONFIG       é…ç½®æ–‡ä»¶è·¯å¾„ (JSONæ ¼å¼)
  --log-level {DEBUG,INFO,WARNING,ERROR}
                        æ—¥å¿—çº§åˆ« (é»˜è®¤: INFO)
  --log-file LOG_FILE   æ—¥å¿—æ–‡ä»¶è·¯å¾„
  --port PORT           WebæœåŠ¡å™¨ç«¯å£ (é»˜è®¤: 8080)
```

## ğŸ“ˆ éªŒè¯ç»´åº¦

### é™æ€åˆ†æ
- âœ… æ§åˆ¶å¹³é¢é…ç½®è§£æ
- âœ… æ•°æ®å¹³é¢é…ç½®è§£æ
- âœ… å¹³é¢é—´ä¸€è‡´æ€§å¯¹æ¯”
- âœ… ç­–ç•¥æå–å’Œåˆ†ç±»
- âœ… æœåŠ¡å…³ç³»å»ºæ¨¡

### åŠ¨æ€åˆ†æ
- âœ… æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œç»“æœ
- âœ… HTTPå“åº”éªŒè¯
- âœ… è·¯ç”±è¡Œä¸ºéªŒè¯
- âœ… æµé‡åˆ†é…éªŒè¯
- âœ… é‡è¯•å’Œè¶…æ—¶éªŒè¯
- âœ… ç†”æ–­ç­–ç•¥éªŒè¯

### ä¸€è‡´æ€§æ£€æµ‹
- âœ… ç­–ç•¥æœ‰æ•ˆæ€§ï¼ˆæ˜¯å¦è¢«éªŒè¯ï¼‰
- âœ… ä½œç”¨èŒƒå›´ä¸€è‡´æ€§ï¼ˆå­é›†è¦†ç›–ï¼‰
- âœ… è¡Œä¸ºåå·®æ£€æµ‹ï¼ˆæœŸæœ›vså®é™…ï¼‰
- âœ… ç­–ç•¥å†²çªè¯†åˆ«
- âœ… ä¸¥é‡ç¨‹åº¦åˆ†çº§

## ğŸ“Š æŠ¥å‘Šç¤ºä¾‹

### JSONæŠ¥å‘Šç»“æ„

```json
{
  "report_id": "report_20250101_120000",
  "title": "Istioé…ç½®ä¸€è‡´æ€§éªŒè¯æŠ¥å‘Š",
  "timestamp": "2025-01-01T12:00:00",
  "consistency_check": {
    "overall_status": "partial",
    "consistency_rate": 0.85,
    "total_policies": 20,
    "verified_policies": 17,
    "inconsistencies": [...]
  },
  "graph_data": {
    "nodes": [...],
    "edges": [...]
  }
}
```

### HTMLæŠ¥å‘Šå†…å®¹

- æ‰§è¡Œæ‘˜è¦
- æ€»ä½“ä¸€è‡´æ€§çŠ¶æ€
- å…³é”®æŒ‡æ ‡å¡ç‰‡
- é™æ€åˆ†æç»“æœè¡¨æ ¼
- åŠ¨æ€æµ‹è¯•ç»“æœè¡¨æ ¼
- ä¸ä¸€è‡´æ€§è¯¦æƒ…åˆ—è¡¨
- ä¿®å¤å»ºè®®

## ğŸ”— æ¨¡å—é›†æˆ

### ä¸é™æ€åˆ†ææ¨¡å—é›†æˆ

```python
from consistency_checker.core.static_analyzer import StaticAnalyzer

analyzer = StaticAnalyzer(
    config_dir="istio_config_parser/istio_control_config",
    namespace="online-boutique"
)
result = analyzer.analyze()
```

### ä¸åŠ¨æ€æµ‹è¯•æ¨¡å—é›†æˆ

```python
from consistency_checker.core.dynamic_analyzer import DynamicAnalyzer

analyzer = DynamicAnalyzer(
    test_matrix_file="istio_Dynamic_Test/generator/output_matrix.json",
    verification_dir="istio_Dynamic_Test/results/verification"
)
result = analyzer.analyze()
```

### å®Œæ•´æµæ°´çº¿

```python
from consistency_checker.core.orchestrator import Pipeline

pipeline = Pipeline(namespace="online-boutique")
report = pipeline.run_full_pipeline()

print(f"ä¸€è‡´æ€§ç‡: {report.consistency_check.consistency_rate:.2%}")
print(f"ä¸ä¸€è‡´æ€§: {len(report.consistency_check.inconsistencies)}")
```

## ğŸ¨ å¯è§†åŒ–ç‰¹æ€§

### æœåŠ¡æ‹“æ‰‘å›¾

- èŠ‚ç‚¹è¡¨ç¤ºæœåŠ¡
- è¾¹è¡¨ç¤ºè·¯ç”±å’Œæµé‡å…³ç³»
- é¢œè‰²ç¼–ç ä¸€è‡´æ€§çŠ¶æ€ï¼š
  - ğŸŸ¢ ç»¿è‰²ï¼šä¸€è‡´
  - ğŸŸ  æ©™è‰²ï¼šéƒ¨åˆ†ä¸€è‡´
  - ğŸ”´ çº¢è‰²ï¼šä¸ä¸€è‡´
  - âš« ç°è‰²ï¼šæœªçŸ¥

### äº¤äº’å¼Webç•Œé¢

- æŠ¥å‘Šåˆ—è¡¨ç®¡ç†
- ä¸€é”®æ‰§è¡Œæµæ°´çº¿
- å®æ—¶æŸ¥çœ‹éªŒè¯ç»“æœ
- å›¾å½¢åŒ–å±•ç¤ºä¸ä¸€è‡´æ€§

## ğŸ“ æ—¥å¿—

ç³»ç»Ÿä½¿ç”¨Pythonæ ‡å‡†loggingæ¨¡å—ï¼Œæ”¯æŒï¼š

- æ§åˆ¶å°è¾“å‡º
- æ–‡ä»¶è¾“å‡º
- æ—¥å¿—çº§åˆ«æ§åˆ¶
- ç»“æ„åŒ–æ—¥å¿—æ ¼å¼

## ğŸ§ª æµ‹è¯•

è¿è¡Œå•å…ƒæµ‹è¯•ï¼š

```bash
python -m pytest tests/
```

## ğŸ“¦ ä¾èµ–

ä¸»è¦ä¾èµ–ï¼š
- Python 3.7+
- Flask (WebæœåŠ¡)
- PyYAML (é…ç½®è§£æ)
- ç°æœ‰çš„ `istio_config_parser` å’Œ `istio_Dynamic_Test` æ¨¡å—

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç å’Œåé¦ˆé—®é¢˜ï¼

## ğŸ“„ è®¸å¯è¯

MIT License


